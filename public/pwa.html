<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是PWA | 珠峰架构课</title>
    <meta name="description" content="前端技术">
    
    
    <link rel="preload" href="/assets/css/0.styles.4cbd323c.css" as="style"><link rel="preload" href="/assets/js/app.1b92515e.js" as="script"><link rel="preload" href="/assets/js/2.370e7e65.js" as="script"><link rel="preload" href="/assets/js/26.437dd587.js" as="script"><link rel="prefetch" href="/assets/js/10.a21a18c5.js"><link rel="prefetch" href="/assets/js/11.21788e04.js"><link rel="prefetch" href="/assets/js/12.dee63b0f.js"><link rel="prefetch" href="/assets/js/13.6e202dde.js"><link rel="prefetch" href="/assets/js/14.40641029.js"><link rel="prefetch" href="/assets/js/15.5300bc30.js"><link rel="prefetch" href="/assets/js/16.f97f1c69.js"><link rel="prefetch" href="/assets/js/17.ffcff957.js"><link rel="prefetch" href="/assets/js/18.37d9114d.js"><link rel="prefetch" href="/assets/js/19.dd47af39.js"><link rel="prefetch" href="/assets/js/20.9df3ac40.js"><link rel="prefetch" href="/assets/js/21.fd093493.js"><link rel="prefetch" href="/assets/js/22.03c8d059.js"><link rel="prefetch" href="/assets/js/23.cce4b95f.js"><link rel="prefetch" href="/assets/js/24.085e6587.js"><link rel="prefetch" href="/assets/js/25.34a54844.js"><link rel="prefetch" href="/assets/js/27.8d500bac.js"><link rel="prefetch" href="/assets/js/28.e4bc7dd0.js"><link rel="prefetch" href="/assets/js/29.4d85bcee.js"><link rel="prefetch" href="/assets/js/3.1cacdac7.js"><link rel="prefetch" href="/assets/js/30.8d1ee13d.js"><link rel="prefetch" href="/assets/js/31.0b3c5fdd.js"><link rel="prefetch" href="/assets/js/32.e5bbe7c4.js"><link rel="prefetch" href="/assets/js/33.7eb36ae2.js"><link rel="prefetch" href="/assets/js/34.b88e55f0.js"><link rel="prefetch" href="/assets/js/35.9d5c408a.js"><link rel="prefetch" href="/assets/js/36.27459212.js"><link rel="prefetch" href="/assets/js/37.7c0f4d16.js"><link rel="prefetch" href="/assets/js/38.a3a27b20.js"><link rel="prefetch" href="/assets/js/39.fdf02e73.js"><link rel="prefetch" href="/assets/js/4.6baae568.js"><link rel="prefetch" href="/assets/js/40.f55a00d4.js"><link rel="prefetch" href="/assets/js/41.5369bfd1.js"><link rel="prefetch" href="/assets/js/42.7b20dcfa.js"><link rel="prefetch" href="/assets/js/43.1e198e47.js"><link rel="prefetch" href="/assets/js/44.94c47fc4.js"><link rel="prefetch" href="/assets/js/45.1b2fa0d2.js"><link rel="prefetch" href="/assets/js/46.3cd24b59.js"><link rel="prefetch" href="/assets/js/47.7c4aa349.js"><link rel="prefetch" href="/assets/js/48.ab2d6e5f.js"><link rel="prefetch" href="/assets/js/49.b715833f.js"><link rel="prefetch" href="/assets/js/5.a5c1265f.js"><link rel="prefetch" href="/assets/js/50.b636e4a0.js"><link rel="prefetch" href="/assets/js/51.82d9355c.js"><link rel="prefetch" href="/assets/js/52.e3626f37.js"><link rel="prefetch" href="/assets/js/53.b98d79d2.js"><link rel="prefetch" href="/assets/js/54.5ffe5351.js"><link rel="prefetch" href="/assets/js/55.22898f7b.js"><link rel="prefetch" href="/assets/js/56.0002a287.js"><link rel="prefetch" href="/assets/js/57.08ab88a9.js"><link rel="prefetch" href="/assets/js/58.a199fa5e.js"><link rel="prefetch" href="/assets/js/59.76596f2e.js"><link rel="prefetch" href="/assets/js/6.ef8139bd.js"><link rel="prefetch" href="/assets/js/60.af020deb.js"><link rel="prefetch" href="/assets/js/61.fcd987e7.js"><link rel="prefetch" href="/assets/js/7.d40030ec.js"><link rel="prefetch" href="/assets/js/8.5288b31e.js"><link rel="prefetch" href="/assets/js/9.7569e6b6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4cbd323c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">珠峰架构课</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">TypeScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">精品公开课</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/public/pwa.html" class="nav-link router-link-exact-active router-link-active">玩转PWA</a></li><li class="dropdown-item"><!----> <a href="/public/vuex.html" class="nav-link">vuex原理</a></li><li class="dropdown-item"><!----> <a href="/public/vue-ssr.html" class="nav-link">vue-ssr原理</a></li><li class="dropdown-item"><!----> <a href="/public/cli.html" class="nav-link">实现通用脚手架</a></li><li class="dropdown-item"><!----> <a href="/unit/unit-1.html" class="nav-link">单元测试</a></li><li class="dropdown-item"><!----> <a href="/webpack/note-1.html" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/uni-app/note-1.html" class="nav-link">uni-app</a></li><li class="dropdown-item"><!----> <a href="/public/vue3.0.html" class="nav-link">剖析vue3.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JS核心</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js-core/js-1.html" class="nav-link">js基础概念</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">VUE训练营</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-info/component.html" class="nav-link">vue组件间通信</a></li><li class="dropdown-item"><!----> <a href="/vue-info/jsx.html" class="nav-link">jsx渲染函数</a></li><li class="dropdown-item"><!----> <a href="/vue-info/jwt.html" class="nav-link">JWT认证</a></li><li class="dropdown-item"><!----> <a href="/vue-info/cascader.html" class="nav-link">级联组件的编写</a></li><li class="dropdown-item"><!----> <a href="/vue-info/unit.html" class="nav-link">单元测试</a></li><li class="dropdown-item"><!----> <a href="/vue-info/auth.html" class="nav-link">vue权限</a></li><li class="dropdown-item"><!----> <a href="/vue-info/vue-router.html" class="nav-link">实现路由和状态管理</a></li><li class="dropdown-item"><!----> <a href="/vue-info/source.html" class="nav-link">vue原理剖析</a></li><li class="dropdown-item"><!----> <a href="/vue-info/optimize.html" class="nav-link">Vue相关优化</a></li><li class="dropdown-item"><!----> <a href="/vue-info/vue+ts.html" class="nav-link">Vue+TypeScript</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">TypeScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">精品公开课</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/public/pwa.html" class="nav-link router-link-exact-active router-link-active">玩转PWA</a></li><li class="dropdown-item"><!----> <a href="/public/vuex.html" class="nav-link">vuex原理</a></li><li class="dropdown-item"><!----> <a href="/public/vue-ssr.html" class="nav-link">vue-ssr原理</a></li><li class="dropdown-item"><!----> <a href="/public/cli.html" class="nav-link">实现通用脚手架</a></li><li class="dropdown-item"><!----> <a href="/unit/unit-1.html" class="nav-link">单元测试</a></li><li class="dropdown-item"><!----> <a href="/webpack/note-1.html" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/uni-app/note-1.html" class="nav-link">uni-app</a></li><li class="dropdown-item"><!----> <a href="/public/vue3.0.html" class="nav-link">剖析vue3.0</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JS核心</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js-core/js-1.html" class="nav-link">js基础概念</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">VUE训练营</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-info/component.html" class="nav-link">vue组件间通信</a></li><li class="dropdown-item"><!----> <a href="/vue-info/jsx.html" class="nav-link">jsx渲染函数</a></li><li class="dropdown-item"><!----> <a href="/vue-info/jwt.html" class="nav-link">JWT认证</a></li><li class="dropdown-item"><!----> <a href="/vue-info/cascader.html" class="nav-link">级联组件的编写</a></li><li class="dropdown-item"><!----> <a href="/vue-info/unit.html" class="nav-link">单元测试</a></li><li class="dropdown-item"><!----> <a href="/vue-info/auth.html" class="nav-link">vue权限</a></li><li class="dropdown-item"><!----> <a href="/vue-info/vue-router.html" class="nav-link">实现路由和状态管理</a></li><li class="dropdown-item"><!----> <a href="/vue-info/source.html" class="nav-link">vue原理剖析</a></li><li class="dropdown-item"><!----> <a href="/vue-info/optimize.html" class="nav-link">Vue相关优化</a></li><li class="dropdown-item"><!----> <a href="/vue-info/vue+ts.html" class="nav-link">Vue+TypeScript</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/public/pwa.html" class="active sidebar-link">什么是PWA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/public/pwa.html#web-app-manifest" class="sidebar-link">Web App Manifest</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/public/pwa.html#web-app-manifest设置" class="sidebar-link">Web App Manifest设置</a></li><li class="sidebar-sub-header"><a href="/public/pwa.html#ios-meta-link-私有属性设置" class="sidebar-link">ios meta/link 私有属性设置</a></li></ul></li><li class="sidebar-sub-header"><a href="/public/pwa.html#service-worker" class="sidebar-link">Service Worker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/public/pwa.html#serviceworker中的方法" class="sidebar-link">serviceWorker中的方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/public/pwa.html#notification-api" class="sidebar-link">Notification API</a></li><li class="sidebar-sub-header"><a href="/public/pwa.html#workbox" class="sidebar-link">workbox</a></li><li class="sidebar-sub-header"><a href="/public/pwa.html#在vue中使用pwa" class="sidebar-link">在vue中使用pwa</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="什么是pwa"><a href="#什么是pwa" aria-hidden="true" class="header-anchor">#</a> 什么是PWA</h1> <p>webapp用户体验差（不能离线访问），用户粘性低（无法保存入口），pwa就是为了解决这一系列问题（Progressive Web Apps）,让webapp具有快速，可靠，安全等特点</p> <h3 id="pwa一系列用到的技术"><a href="#pwa一系列用到的技术" aria-hidden="true" class="header-anchor">#</a> PWA一系列用到的技术</h3> <ul><li>Web App Manifest</li> <li>Service Worker</li> <li>Push Api &amp; Notification Api</li> <li>App Shell &amp; App Skeleton</li> <li>...</li></ul> <h2 id="web-app-manifest"><a href="#web-app-manifest" aria-hidden="true" class="header-anchor">#</a> Web App Manifest</h2> <p>将网站添加到桌面、更类似native的体验</p> <h3 id="web-app-manifest设置"><a href="#web-app-manifest设置" aria-hidden="true" class="header-anchor">#</a> Web App Manifest设置</h3> <div class="language-json line-numbers-mode"><pre class="language-json"><code>&lt;link rel=<span class="token string">&quot;manifest&quot;</span> href=<span class="token string">&quot;/manifest.json&quot;</span>&gt;
<span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;珠峰课堂&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 应用名称  </span>
    <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span><span class="token string">&quot;课堂&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 桌面应用的名称  ✓</span>
    <span class="token property">&quot;display&quot;</span><span class="token operator">:</span><span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span> <span class="token comment">// fullScreen (standalone) minimal-ui browser ✓</span>
    <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 打开时的网址  ✓</span>
    <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 设置桌面图片 icon图标 修改图标需要重新添加到桌面icons:[{src,sizes,type}]</span>
    <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#aaa&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 启动画面颜色</span>
    <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#aaa&quot;</span> <span class="token comment">// 状态栏的颜色</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="ios-meta-link-私有属性设置"><a href="#ios-meta-link-私有属性设置" aria-hidden="true" class="header-anchor">#</a> ios meta/link 私有属性设置</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code>图标icon
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apple-touch-icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apple-touch-icon-iphone.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
添加到主屏后的标题 和 short_name一致
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>标题<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
隐藏safari地址栏 standalone模式下默认隐藏
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-capable<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>yes<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
设置状态栏颜色
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-status-bar-style<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>black-translucent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>横幅安装：用户在浏览器中访问至少两次，两次访问间隔至少时间为五分钟（safari不支持横幅）</p> <h2 id="service-worker"><a href="#service-worker" aria-hidden="true" class="header-anchor">#</a> Service Worker</h2> <p>为了提升用户体验</p> <p>Service Worker特点：</p> <ul><li>不能访问／操作dom</li> <li>会自动休眠，不会随浏览器关闭所失效(必须手动卸载)</li> <li>离线缓存内容开发者可控</li> <li>必须在https或者localhost下使用</li> <li>所有的api都基于promise</li></ul> <p><img src="https://www.fullstackjavascript.cn/worker.png" alt="image"></p> <ul><li>安装( installing )：这个状态发生在 Service Worker 注册之后，表示开始安装，触发 install 事件回调指定一些静态资源进行离线缓存。</li> <li>安装后( installed )：Service Worker 已经完成了安装，并且等待其他的 Service Worker 线程被关闭。</li> <li>激活( activating )：在这个状态下没有被其他的 Service Worker 控制的客户端，允许当前的 worker 完成安装，并且清除了其他的 worker 以及关联缓存的旧缓存资源，等待新的 Service Worker 线程被激活。</li> <li>激活后( activated )：在这个状态会处理 activate 事件回调 (提供了更新缓存策略的机会)。并可以处理功能性的事件 fetch (请求)、sync (后台同步)、push (推送)。</li> <li>废弃状态 ( redundant )：这个状态表示一个 Service Worker 的生命周期结束。</li></ul> <h3 id="serviceworker中的方法"><a href="#serviceworker中的方法" aria-hidden="true" class="header-anchor">#</a> serviceWorker中的方法</h3> <ul><li>self.skipWaiting():表示强制当前处在 waiting 状态的 Service Worker 进入 activate 状态</li> <li>event.waitUntil()：传入一个 Promise 为参数，等到该 Promise 为 resolve 状态为止。</li> <li>self.clients.claim()：在 activate 事件回调中执行该方法表示取得页面的控制权, 这样之后打开页面都会使用版本更新的缓存。旧的 Service Worker 脚本不再控制着页面，之后会被停止。</li></ul> <p>实现浏览器离线缓存的功能</p> <ul><li>注册serviceWorker
注册的scope必须在当前域或者子域，不能是父亲路径</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 页面加载完成后 注册serviceWorker</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// http缓存对sw文件使用 no-cache</span>
        navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">registeration</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>registeration<span class="token punctuation">.</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'controllerchange'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">)</span><span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>离线缓存 应用cache缓存请求</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// self 当前线程中的this</span>
<span class="token comment">// 拦截用户发送的所有请求</span>
<span class="token keyword">let</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cache_version_</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> <span class="token number">81</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">CACHAE_LIST</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token string">'/index.css'</span><span class="token punctuation">,</span>
    <span class="token string">'/index.html'</span><span class="token punctuation">,</span>
    <span class="token string">'main.js'</span><span class="token punctuation">,</span>
    <span class="token string">'/getImage'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 独立的线程 可以使用fetch 但是不能使用ajax</span>
<span class="token keyword">function</span> <span class="token function">fetchAndSave</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// res 是流 </span>
        <span class="token comment">// 做缓存操作</span>
        <span class="token keyword">let</span> r <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token operator">=&gt;</span>cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用相应来替换 如果获取不到才用缓存</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>origin <span class="token operator">!==</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/getImage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 调用了接口</span>
        <span class="token comment">// 如果遇到了接口  更新缓存</span>
        e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
            <span class="token function">fetchAndSave</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">//  如果没网 在缓存中 匹配结果 返回请求</span>
                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span>catc <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//  如果没网 在缓存中 匹配结果 返回请求</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用缓存替换</span>

<span class="token comment">// serviceWorker安装的阶段</span>
<span class="token keyword">function</span> <span class="token function">preCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token constant">CACHAE_LIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 安装的过程中需要缓存</span>
    e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
        <span class="token function">preCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>skipWaiting<span class="token punctuation">)</span> 
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">keys</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
        Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 首次立马生效，立即使serviceWorker生效</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">clients</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                clients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">client</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    client<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'serviceWorker更新了'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><ul><li>取消其他serviceWorker</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> registers <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">getRegistrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
registers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">regiter</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    regiter<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注销其他serviceWorker</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>serviceWorker更新后通知用户
线程之间的通讯</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">clients</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    clients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">client</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        client<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'缓存更新了 ，请刷新页面~~~'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="notification-api"><a href="#notification-api" aria-hidden="true" class="header-anchor">#</a> Notification API</h2> <p>Notification.permission 查看用户权限</p> <ul><li>default 默认</li> <li>granted 运行</li> <li>denied 禁止</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token parameter">status</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token string">'granted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">'允许'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            body<span class="token punctuation">:</span> <span class="token string">'用户已经允许'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span><span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="workbox"><a href="#workbox" aria-hidden="true" class="header-anchor">#</a> workbox</h2> <h2 id="在vue中使用pwa"><a href="#在vue中使用pwa" aria-hidden="true" class="header-anchor">#</a> 在vue中使用pwa</h2> <p>https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vue create pwa-project
npm run build // 才具备pwa效果
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>vue-cli3.0配置pwa</p> <p>在public目录下可以更改manifest配置文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  pwa<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'My App'</span><span class="token punctuation">,</span>
    themeColor<span class="token punctuation">:</span> <span class="token string">'#f2f2f2'</span><span class="token punctuation">,</span>
    msTileColor<span class="token punctuation">:</span> <span class="token string">'#aaaaa'</span><span class="token punctuation">,</span>
    appleMobileWebAppCapable<span class="token punctuation">:</span> <span class="token string">'yes'</span><span class="token punctuation">,</span>
    appleMobileWebAppStatusBarStyle<span class="token punctuation">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>

    workboxPluginMode<span class="token punctuation">:</span> <span class="token string">'InjectManifest'</span><span class="token punctuation">,</span>
    workboxOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// swSrc is required in InjectManifest mode.</span>
       swSrc<span class="token punctuation">:</span> <span class="token string">'dev/sw.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>需要更改registerServiceWorker文件 更改为sw.js</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 设置缓存前缀</span>
workbox<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token function">setCacheNameDetails</span><span class="token punctuation">(</span><span class="token punctuation">{</span>prefix<span class="token punctuation">:</span> <span class="token string">&quot;pwa-project&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置预缓存列表</span>
self<span class="token punctuation">.</span>__precacheManifest <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__precacheManifest <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">suppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 增加缓存列表策略 </span>
workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">precacheAndRoute</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__precacheManifest<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>基于workbox 缓存工具包 https://developers.google.com/web/tools/workbox</p> <ul><li>内置manifest.json</li> <li>内置serviceWorker</li> <li>内置了缓存策略
<ul><li>cachefirst 缓存优先</li> <li>cacheonly 仅缓存</li> <li>networkfirst 网络优先</li> <li>networkonly 仅网络</li> <li>StaleWhileRevalidate 从缓存取，用网络数据更新缓存</li></ul></li></ul> <p>增加缓存策略</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token comment">// 包涵api的就缓存下来</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">.</span>url<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span><span class="token function">staleWhileRevalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1b92515e.js" defer></script><script src="/assets/js/2.370e7e65.js" defer></script><script src="/assets/js/26.437dd587.js" defer></script>
  </body>
</html>
